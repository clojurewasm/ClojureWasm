# T15.2: Port special.clj test file

## Goal

Port destructuring and special form tests from upstream `test/clojure/test_clojure/special.clj`.

## Upstream Analysis

Source: `/Users/shota.508/Documents/OSS/clojure/test/clojure/test_clojure/special.clj`

Tests (13 total):

1. `multiple-keys-in-destructuring` — rest args + map destructuring (& {:keys [x]})
2. `empty-list-with-:as-destructuring` — {:as x} with empty list
3. `keywords-in-destructuring` — {:keys [:a :b]} syntax
4. `namespaced-keywords-in-destructuring` — {:keys [:a/b]} syntax
5. `namespaced-keys-in-destructuring` — {:keys [a/b]} syntax
6. `namespaced-syms-in-destructuring` — {:syms [a/b]} syntax
7. `namespaced-keys-syntax` — {:a/keys [b]} syntax
8. `namespaced-syms-syntax` — {:a/syms [b]} syntax
9. `keywords-not-allowed-in-let-bindings` — error tests (thrown-with-cause-msg)
10. `namespaced-syms-only-allowed-in-map-destructuring` — error tests
11. `or-doesnt-create-bindings` — error test
12. `resolve-keyword-ns-alias-in-destructuring` — ::alias/key syntax
13. `quote-with-multiple-args` — JVM exception handling
14. `typehints-retained-destructuring` — JVM reflection test

## JVM Dependencies

High dependency - many tests use:

- `thrown-with-cause-msg?` (JVM exception)
- `clojure.lang.Compiler$CompilerException` (JVM class)
- `should-not-reflect` (JVM reflection test)
- Java method calls (`.getCause`, `.indexOf`)

## Portable Tests

Only these are portable without JVM:

1. `empty-list-with-:as-destructuring` — simple, should work
2. (others require advanced destructuring features)

## Known Limitations

From compat_test.yaml and checklist.md:

- {:keys [:a :b]} — keyword in :keys vector not supported
- F58: nested map destructuring
- Rest args + map destructuring may not be implemented

## Plan

1. Test which destructuring features work in ClojureWasm
2. Port tests that work, document F## for others
3. Update compat_test.yaml

## Log

- Created test/clojure/special.clj with 9 tests (partial port)
- All tests pass
- Added F67-F74 to checklist.md for unsupported destructuring features
- Updated compat_test.yaml: +9 tests, +22 assertions

Tests ported (9 new tests focusing on working destructuring):

1. basic-keys-destructuring
2. keys-with-or-destructuring
3. strs-destructuring
4. syms-destructuring
5. as-destructuring
6. combined-destructuring
7. sequential-as-destructuring
8. nested-sequential-destructuring
9. rest-destructuring

Excluded features (F67-F74):

- F67: rest args + map destructuring (& {:keys [x]})
- F68: {:as x} on empty list returns () instead of {}
- F69: keywords in :keys vector {:keys [:a :b]}
- F70-F74: namespaced destructuring variations
- JVM exception tests (thrown-with-cause-msg)
- JVM reflection test (should-not-reflect)
