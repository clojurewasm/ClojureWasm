# ClojureWasm Benchmark Results (v2)
#
# Schema: env + benchmarks (11) + latest + history
# Measurement: bash bench/run_bench.sh --hyperfine

env:
  cpu: Apple M4 Pro
  ram: 48 GB
  os: Darwin 25.2.0 (arm64)
  versions:
    clojurewasm: "Phase 5 (TreeWalk)"
    zig: "0.15.2"
    c: "clang (system)"
    java: "25.0.0"
    python: "3.14.2"
    ruby: "4.0.1"
    clojure: "latest (deps.edn)"
    babashka: "latest"
benchmarks:
  fib_recursive:
    description: "Naive recursive fibonacci fib(25) — function call overhead"
    category: computation
    expected: 75025
    clj_file: "bench/benchmarks/01_fib_recursive/bench.clj"
  fib_loop:
    description: "Iterative fibonacci fib(25) — tail recursion (loop/recur)"
    category: computation
    expected: 75025
    clj_file: "bench/benchmarks/02_fib_loop/bench.clj"
  tak:
    description: "Takeuchi function tak(18,12,6) — non-tail deep recursion"
    category: computation
    expected: 7
    clj_file: "bench/benchmarks/03_tak/bench.clj"
  arith_loop:
    description: "Arithmetic loop (1M iterations) — numeric ops + loop/recur"
    category: computation
    expected: 499999500000
    clj_file: "bench/benchmarks/04_arith_loop/bench.clj"
  map_filter_reduce:
    description: "Map/filter/reduce chain over 10K elements"
    category: collections
    expected: 166616670000
    clj_file: "bench/benchmarks/05_map_filter_reduce/bench.clj"
  vector_ops:
    description: "Vector conj + nth loop (10K elements)"
    category: collections
    expected: 49995000
    clj_file: "bench/benchmarks/06_vector_ops/bench.clj"
  map_ops:
    description: "Map assoc + get loop (1K entries)"
    category: collections
    expected: 499500
    clj_file: "bench/benchmarks/07_map_ops/bench.clj"
  list_build:
    description: "Cons list build + count (10K elements)"
    category: collections
    expected: 10000
    clj_file: "bench/benchmarks/08_list_build/bench.clj"
  sieve:
    description: "Sieve of Eratosthenes with filter (primes up to 1000)"
    category: hof
    expected: 168
    clj_file: "bench/benchmarks/09_sieve/bench.clj"
  nqueens:
    description: "N-Queens backtracking for N=8"
    category: hof
    expected: 92
    clj_file: "bench/benchmarks/10_nqueens/bench.clj"
  atom_swap:
    description: "Atom reset!/deref loop (10K iterations)"
    category: state
    expected: 10000
    clj_file: "bench/benchmarks/11_atom_swap/bench.clj"
previous:
  date: "2026-02-02"
  version: Phase 10 VM baseline
  results:
    arith_loop:
      clojurewasm:
        time_ms: 213
        mem_mb: null
    map_filter_reduce:
      clojurewasm:
        time_ms: 623
        mem_mb: null
    vector_ops:
      clojurewasm:
        time_ms: 133
        mem_mb: null
    fib_recursive:
      clojurewasm:
        time_ms: 54
        mem_mb: null
    map_ops:
      clojurewasm:
        time_ms: 26
        mem_mb: null
    nqueens:
      clojurewasm:
        time_ms: 78
        mem_mb: null
    fib_loop:
      clojurewasm:
        time_ms: 10
        mem_mb: null
    list_build:
      clojurewasm:
        time_ms: 129
        mem_mb: null
    sieve:
      clojurewasm:
        time_ms: 299
        mem_mb: null
    atom_swap:
      clojurewasm:
        time_ms: 19
        mem_mb: null
    tak:
      clojurewasm:
        time_ms: 22
        mem_mb: null
latest:
  date: "2026-02-02"
  version: Phase 10 TreeWalk
  results:
    arith_loop:
      clojurewasm:
        time_ms: 840
        mem_mb: null
    map_filter_reduce:
      clojurewasm:
        time_ms: 381
        mem_mb: null
    vector_ops:
      clojurewasm:
        time_ms: 145
        mem_mb: null
    fib_recursive:
      clojurewasm:
        time_ms: 494
        mem_mb: null
    map_ops:
      clojurewasm:
        time_ms: 27
        mem_mb: null
    nqueens:
      clojurewasm:
        time_ms: 214
        mem_mb: null
    fib_loop:
      clojurewasm:
        time_ms: 11
        mem_mb: null
    list_build:
      clojurewasm:
        time_ms: 135
        mem_mb: null
    sieve:
      clojurewasm:
        time_ms: 86
        mem_mb: null
    atom_swap:
      clojurewasm:
        time_ms: 28
        mem_mb: null
    tak:
      clojurewasm:
        time_ms: 124
        mem_mb: null
# Phase 3 baseline results (TreeWalk, Debug, Apple M4 Pro)
history:
  - date: "2026-02-02"
    version: "Phase 3 complete (TreeWalk, Debug)"
    results:
      startup: {time_ms: 2.6, stddev_ms: 0.2}
      fib30: {time_ms: 3240, stddev_ms: 30}
      arith_loop: {time_ms: 1300, note: "approximate (time command)"}
      higher_order: {time_ms: 3, note: "dominated by startup"}
  - date: "2026-02-02"
    version: Phase 5 baseline
  - date: "2026-02-02"
    version: Phase 10 VM baseline
  - date: "2026-02-02"
    version: Phase 10 TreeWalk
