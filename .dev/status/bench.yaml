# ClojureWasm Benchmark Results (v2)
#
# Schema: env + benchmarks (20) + latest + history
# Build: ReleaseSafe (mandatory for all benchmarks)
# Backend: VM
# Measurement: bash bench/run_bench.sh --release-safe --backend=vm

env:
  cpu: Apple M4 Pro
  ram: 48 GB
  os: Darwin 25.2.0 (arm64)
  versions:
    clojurewasm: "Phase 5 (TreeWalk)"
    zig: "0.15.2"
    c: "clang (system)"
    java: "25.0.0"
    python: "3.14.2"
    ruby: "4.0.1"
    clojure: "latest (deps.edn)"
    babashka: "latest"
benchmarks:
  fib_recursive:
    description: "Naive recursive fibonacci fib(25) — function call overhead"
    category: computation
    expected: 75025
    clj_file: "bench/benchmarks/01_fib_recursive/bench.clj"
  fib_loop:
    description: "Iterative fibonacci fib(25) — tail recursion (loop/recur)"
    category: computation
    expected: 75025
    clj_file: "bench/benchmarks/02_fib_loop/bench.clj"
  tak:
    description: "Takeuchi function tak(18,12,6) — non-tail deep recursion"
    category: computation
    expected: 7
    clj_file: "bench/benchmarks/03_tak/bench.clj"
  arith_loop:
    description: "Arithmetic loop (1M iterations) — numeric ops + loop/recur"
    category: computation
    expected: 499999500000
    clj_file: "bench/benchmarks/04_arith_loop/bench.clj"
  map_filter_reduce:
    description: "Map/filter/reduce chain over 10K elements"
    category: collections
    expected: 166616670000
    clj_file: "bench/benchmarks/05_map_filter_reduce/bench.clj"
  vector_ops:
    description: "Vector conj + nth loop (10K elements)"
    category: collections
    expected: 49995000
    clj_file: "bench/benchmarks/06_vector_ops/bench.clj"
  map_ops:
    description: "Map assoc + get loop (1K entries)"
    category: collections
    expected: 499500
    clj_file: "bench/benchmarks/07_map_ops/bench.clj"
  list_build:
    description: "Cons list build + count (10K elements)"
    category: collections
    expected: 10000
    clj_file: "bench/benchmarks/08_list_build/bench.clj"
  sieve:
    description: "Sieve of Eratosthenes with filter (primes up to 1000)"
    category: hof
    expected: 168
    clj_file: "bench/benchmarks/09_sieve/bench.clj"
  nqueens:
    description: "N-Queens backtracking for N=8"
    category: hof
    expected: 92
    clj_file: "bench/benchmarks/10_nqueens/bench.clj"
  atom_swap:
    description: "Atom reset!/deref loop (10K iterations)"
    category: state
    expected: 10000
    clj_file: "bench/benchmarks/11_atom_swap/bench.clj"
  gc_stress:
    description: "Allocation-heavy loop creating 100K short-lived maps"
    category: gc
    expected: 5000050000
    clj_file: "bench/benchmarks/12_gc_stress/bench.clj"
  lazy_chain:
    description: "Lazy seq chain (range->map->filter->take->reduce) 10K elements"
    category: sequences
    expected: 299970000
    clj_file: "bench/benchmarks/13_lazy_chain/bench.clj"
  transduce:
    description: "Transducer pipeline (comp map filter) over 10K elements"
    category: sequences
    expected: 74985000
    clj_file: "bench/benchmarks/14_transduce/bench.clj"
  keyword_lookup:
    description: "Keyword map access in tight loop (100K iterations)"
    category: collections
    expected: 9500000
    clj_file: "bench/benchmarks/15_keyword_lookup/bench.clj"
  protocol_dispatch:
    description: "Protocol method call in tight loop (10K iterations)"
    category: dispatch
    expected: 149985000
    clj_file: "bench/benchmarks/16_protocol_dispatch/bench.clj"
  nested_update:
    description: "update-in/get-in on 3-level nested map (10K iterations)"
    category: collections
    expected: 10000
    clj_file: "bench/benchmarks/17_nested_update/bench.clj"
  string_ops:
    description: "str conversion + count in tight loop (100K iterations)"
    category: string
    expected: 488890
    clj_file: "bench/benchmarks/18_string_ops/bench.clj"
  multimethod_dispatch:
    description: "defmulti dispatch in tight loop (10K iterations)"
    category: dispatch
    expected: 70000
    clj_file: "bench/benchmarks/19_multimethod_dispatch/bench.clj"
  real_workload:
    description: "Data transform pipeline: build records, filter, map, reduce"
    category: composite
    expected: 33336666
    clj_file: "bench/benchmarks/20_real_workload/bench.clj"
previous:
  date: "2026-02-06"
  version: Pre-Phase24 VM ReleaseSafe
  results:
    fib_recursive:
      clojurewasm: {time_ms: 542}
    fib_loop:
      clojurewasm: {time_ms: 56}
    tak:
      clojurewasm: {time_ms: 53}
    arith_loop:
      clojurewasm: {time_ms: 98}
    map_filter_reduce:
      clojurewasm: {time_ms: 4013}
    vector_ops:
      clojurewasm: {time_ms: 426}
    map_ops:
      clojurewasm: {time_ms: 62}
    list_build:
      clojurewasm: {time_ms: 420}
    sieve:
      clojurewasm: {time_ms: 2152, note: "F97 GC double-free"}
    nqueens:
      clojurewasm: {time_ms: 61}
    atom_swap:
      clojurewasm: {time_ms: 51}
    gc_stress:
      clojurewasm: {time_ms: 372}
    lazy_chain:
      clojurewasm: {time_ms: 21375}
    transduce:
      clojurewasm: {time_ms: 8409}
    keyword_lookup:
      clojurewasm: {time_ms: 59}
    protocol_dispatch:
      clojurewasm: {time_ms: 52}
    nested_update:
      clojurewasm: {time_ms: 292}
    string_ops:
      clojurewasm: {time_ms: 446}
    multimethod_dispatch:
      clojurewasm: {time_ms: 2373}
    real_workload:
      clojurewasm: {time_ms: 1286}
latest:
  date: "2026-02-06"
  version: After 24A.4 VM ReleaseSafe
  results:
    fib_recursive:
      clojurewasm: {time_ms: 41}
    fib_loop:
      clojurewasm: {time_ms: 29}
    tak:
      clojurewasm: {time_ms: 36}
    arith_loop:
      clojurewasm: {time_ms: 72}
    map_filter_reduce:
      clojurewasm: {time_ms: 1315}
    vector_ops:
      clojurewasm: {time_ms: 186}
    map_ops:
      clojurewasm: {time_ms: 38}
    list_build:
      clojurewasm: {time_ms: 188}
    sieve:
      clojurewasm: {time_ms: 42, note: "F97 GC double-free, unreliable"}
    nqueens:
      clojurewasm: {time_ms: 40}
    atom_swap:
      clojurewasm: {time_ms: 30}
    gc_stress:
      clojurewasm: {time_ms: 351}
    lazy_chain:
      clojurewasm: {time_ms: 7425}
    transduce:
      clojurewasm: {time_ms: 3043}
    keyword_lookup:
      clojurewasm: {time_ms: 35}
    protocol_dispatch:
      clojurewasm: {time_ms: 29}
    nested_update:
      clojurewasm: {time_ms: 135}
    string_ops:
      clojurewasm: {time_ms: 417}
    multimethod_dispatch:
      clojurewasm: {time_ms: 1985}
    real_workload:
      clojurewasm: {time_ms: 513}
history:
  - date: "2026-02-06"
    version: Pre-Phase24 VM ReleaseSafe
  - date: "2026-02-06"
    version: After 24A.4 VM ReleaseSafe
