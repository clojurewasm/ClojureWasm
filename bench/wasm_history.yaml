# Wasm Runtime Benchmark History
# Tracks ClojureWasm interpreter vs wasmtime JIT performance over time.
# All times in milliseconds, "warm" = total - startup overhead.
# Measured via bench/wasm_bench.sh (hyperfine, startup subtracted).
# NOTE: wasm modules rebuilt with -scheduler=none since 45.1b (8KB vs 18KB).
env:
  cpu: Apple M4 Pro
  ram: 48 GB
  os: Darwin 25.2.0
  tool: hyperfine
  wasm_source: TinyGo 0.40.1
  wasm_build_flags: "-target=wasm -no-debug -gc=leaking -scheduler=none -opt=2"
entries:
  - id: "45.1b-baseline"
    date: "2026-02-10"
    reason: "Expanded baseline — 6 benchmarks, -scheduler=none rebuild"
    commit: pending
    build: ReleaseSafe
    cw_startup_ms: 4.6
    wt_startup_ms: 8.3
    results:
      fib:
        desc: "fib(20) x 10000"
        cw_warm_ms: 10070
        wt_warm_ms: 203
        ratio: 49.7
      tak:
        desc: "tak(18,12,6) x 10000"
        cw_warm_ms: 27320
        wt_warm_ms: 1153
        ratio: 23.7
      arith:
        desc: "arith(1M) x 10"
        cw_warm_ms: 0.4
        wt_warm_ms: 0.7
        ratio: 0.6
      sieve:
        desc: "sieve(64K) x 100"
        cw_warm_ms: 600
        wt_warm_ms: 3.5
        ratio: 171.4
      fib_loop:
        desc: "fib_loop(25) x 1000000"
        cw_warm_ms: 402
        wt_warm_ms: 0.1
        ratio: 4022.0
      gcd:
        desc: "gcd(1M,700K) x 1000000"
        cw_warm_ms: 633
        wt_warm_ms: 35.5
        ratio: 17.8
  - id: "45.2-predecoded-ir"
    date: "2026-02-10"
    reason: "Predecoded IR — fixed-width 8-byte instructions, no LEB128 at dispatch"
    commit: pending
    build: ReleaseSafe
    cw_startup_ms: 2.7
    wt_startup_ms: 4.6
    results:
      fib:
        desc: "fib(20) x 10000"
        cw_warm_ms: 5682
        wt_warm_ms: 219
        ratio: 25.9
        speedup_vs_prev: 1.77
      tak:
        desc: "tak(18,12,6) x 10000"
        cw_warm_ms: 16264
        wt_warm_ms: 1192
        ratio: 13.6
        speedup_vs_prev: 1.68
      arith:
        desc: "arith(1M) x 10"
        cw_warm_ms: 1.3
        wt_warm_ms: 0.4
        ratio: 3.2
      sieve:
        desc: "sieve(64K) x 100"
        cw_warm_ms: 239
        wt_warm_ms: 5.9
        ratio: 40.5
        speedup_vs_prev: 2.51
      fib_loop:
        desc: "fib_loop(25) x 1000000"
        cw_warm_ms: 192
        wt_warm_ms: 3.7
        ratio: 51.9
        speedup_vs_prev: 2.09
      gcd:
        desc: "gcd(1M,700K) x 1000000"
        cw_warm_ms: 300
        wt_warm_ms: 44.3
        ratio: 6.8
        speedup_vs_prev: 2.11
  - id: "45.4-superinstructions"
    date: "2026-02-10"
    reason: "Superinstructions — fuse local.get+const/local+arith/cmp patterns"
    commit: pending
    build: ReleaseSafe
    cw_startup_ms: 3.5
    wt_startup_ms: 4.7
    results:
      fib:
        desc: "fib(20) x 10000"
        cw_warm_ms: 4366
        wt_warm_ms: 225
        ratio: 19.4
        speedup_vs_prev: 1.30
      tak:
        desc: "tak(18,12,6) x 10000"
        cw_warm_ms: 14450
        wt_warm_ms: 1212
        ratio: 11.9
        speedup_vs_prev: 1.13
      arith:
        desc: "arith(1M) x 10"
        cw_warm_ms: 0.1
        wt_warm_ms: 0.1
        ratio: 1.0
      sieve:
        desc: "sieve(64K) x 100"
        cw_warm_ms: 203
        wt_warm_ms: 5.6
        ratio: 36.2
        speedup_vs_prev: 1.18
      fib_loop:
        desc: "fib_loop(25) x 1000000"
        cw_warm_ms: 178
        wt_warm_ms: 3.0
        ratio: 59.3
        speedup_vs_prev: 1.08
      gcd:
        desc: "gcd(1M,700K) x 1000000"
        cw_warm_ms: 309
        wt_warm_ms: 44.5
        ratio: 6.9
        speedup_vs_prev: 0.97
  - id: "45.5-cached-memory"
    date: "2026-02-10"
    reason: "Cached memory pointer — avoid triple-indirection per load/store"
    commit: pending
    build: ReleaseSafe
    cw_startup_ms: 3.7
    wt_startup_ms: 5.2
    results:
      fib:
        desc: "fib(20) x 10000"
        cw_warm_ms: 4387
        wt_warm_ms: 225
        ratio: 19.5
        speedup_vs_prev: 1.00
      tak:
        desc: "tak(18,12,6) x 10000"
        cw_warm_ms: 14295
        wt_warm_ms: 1217
        ratio: 11.8
        speedup_vs_prev: 1.01
      arith:
        desc: "arith(1M) x 10"
        cw_warm_ms: 0.1
        wt_warm_ms: 0.1
        ratio: 1.0
      sieve:
        desc: "sieve(64K) x 100"
        cw_warm_ms: 198
        wt_warm_ms: 6.6
        ratio: 30.1
        speedup_vs_prev: 1.03
      fib_loop:
        desc: "fib_loop(25) x 1000000"
        cw_warm_ms: 176
        wt_warm_ms: 2.7
        ratio: 65.1
        speedup_vs_prev: 1.01
      gcd:
        desc: "gcd(1M,700K) x 1000000"
        cw_warm_ms: 311
        wt_warm_ms: 44.3
        ratio: 7.0
        speedup_vs_prev: 1.00
